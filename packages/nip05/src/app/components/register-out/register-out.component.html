<!--------------------------->
<!-- STEP 1: SELECT DOMAIN -->
<!--------------------------->
<ng-template #step1>
  <app-card2>
    <div class="flex-column">
      <span class="font-size-plus text-align-center">
        Step 1: Pick a Domain
      </span>
      <span
        class="margin-top margin-bottom font-size-minus text-align-center color-muted"
      >
        This will become the <span class="color-tertiary">domain</span> of your
        Nostr Address.
      </span>

      <app-domain-selector
        [selectedDomain]="dataStep1.domain"
        (selectedDomainChange)="
          dataStep1.domain = $event;
          dataStep2.isAvailable = undefined;
          dataStep2.reason = null
        "
      ></app-domain-selector>
    </div>
  </app-card2>
</ng-template>

<!------------------------------->
<!-- STEP 2: SELECT IDENTIFIER -->
<!------------------------------->
<ng-template #step2>
  <app-card2>
    <div class="flex-column">
      <span class="font-size-plus text-align-center">
        Step 2: Choose an Identifier
      </span>

      <div
        class="flex-row margin-top margin-bottom font-size-minus align-self-center"
      >
        <span class="color-tertiary">{{
          dataStep2.identifier ? dataStep2.identifier : '&lt;identifier&gt;'
        }}</span>
        <span class="color-muted">{{ '@' }}</span>
        <span class="color-muted">{{ dataStep1.domain }}</span>
      </div>

      <!-- <span class="color-muted">
        {{
          dataStep2.identifier
            ? dataStep2.identifier + '@' + dataStep1.domain
            : '&lt;identifier&gt;@' + dataStep1.domain
        }}
      </span> -->

      <app-input2
        class="width-100"
        [(model)]="dataStep2.identifier"
        (modelChange)="
          dataStep2.isAvailable = undefined; dataStep2.reason = null
        "
        (keydown.enter)="onClickCheckAvailability()"
      ></app-input2>

      <app-button2
        class="margin-top"
        [disabled]="!dataStep2.identifier"
        (click)="onClickCheckAvailability()"
      >
        Check Availability
      </app-button2>

      <span
        class="check-result"
        [class.ok]="dataStep2.isAvailable"
        [class.not-ok]="!dataStep2.isAvailable"
        >{{ dataStep2.reason ?? '&nbsp;' }}</span
      >
    </div>
  </app-card2>
</ng-template>

<!---------------------->
<!-- STEP 3: REGISTER -->
<!---------------------->
<ng-template #step3>
  <app-card2>
    <div class="flex-column">
      <span class="font-size-plus text-align-center">
        Step 3: Finalize Registration
      </span>
      <span
        class="margin-top margin-bottom font-size-minus text-align-center color-tertiary"
      >
        {{
          dataStep2.identifier
            ? dataStep2.identifier + '@' + dataStep1.domain
            : '&lt;identifier&gt;@' + dataStep1.domain
        }}
      </span>

      @if(tokenService.token?.isValid) {
      <app-button2>Register</app-button2>
      }
    </div>
  </app-card2>
</ng-template>

<!------------------>
<!-- MAIN CONTENT -->
<!------------------>
<div style="height: 4px; margin-bottom: 18px">
  @if(activity) {
  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  }
</div>

<span class="font-size-plus text-align-center margin-bottom">
  Register a new Nostr Address
</span>

<app-stepper [startWithStep]="startWithStep">
  <app-step [canPrevious]="false" [canNext]="!!dataStep1.domain">
    <ng-container [ngTemplateOutlet]="step1"></ng-container>
  </app-step>

  <app-step [canNext]="dataStep2.isAvailable === true">
    <ng-container [ngTemplateOutlet]="step2"></ng-container>
  </app-step>

  <app-step [canNext]="false">
    <ng-container [ngTemplateOutlet]="step3"></ng-container>
  </app-step>
</app-stepper>
